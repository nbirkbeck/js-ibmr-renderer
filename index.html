<html>
<script src="//cdnjs.cloudflare.com/ajax/libs/three.js/r61/three.js"> </script>
<script src="js/renderer.js"> </script>
<script id="vertexShader" type="x-shader/x-vertex">
varying vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
</script>

<script id="fragmentShader" type="x-shader/x-fragment">
varying vec2 vUv;
uniform sampler2D textureY0;
uniform sampler2D textureY1;
uniform sampler2D textureY2;
uniform sampler2D textureY3;
uniform sampler2D textureU0;
uniform sampler2D textureU1;
uniform sampler2D textureU2;
uniform sampler2D textureU3;
uniform sampler2D textureV0;
uniform sampler2D textureV1;
uniform sampler2D textureV2;
uniform sampler2D textureV3;
uniform float coeffY[16];
uniform float coeffU[16];
uniform float coeffV[16];
uniform mat4 colorMatrix;


#define scale(i) vec4(2.0 * (i.x - 0.5), 2.0 * (i.y - 0.5), 2.0 * (i.z - 0.5), 2.0 * (i.w - 0.5));

void main() {
  vec4 tex0 = scale(texture2D(textureY0, vUv));
  vec4 tex1 = scale(texture2D(textureY1, vUv));
  vec4 tex2 = scale(texture2D(textureY2, vUv));
  vec4 tex3 = scale(texture2D(textureY3, vUv));

  float y = dot(vec4(coeffY[0], coeffY[1], coeffY[2], coeffY[3]), tex0) + 
     dot(vec4(coeffY[4], coeffY[5], coeffY[6], coeffY[7]), tex1) + 
     dot(vec4(coeffY[8], coeffY[9], coeffY[10], coeffY[11]), tex2) +
     dot(vec4(coeffY[12], coeffY[13], coeffY[14], coeffY[15]), tex3);

  tex0 = scale(texture2D(textureU0, vUv));
  tex1 = scale(texture2D(textureU1, vUv));
  tex2 = scale(texture2D(textureU2, vUv));
  tex3 = scale(texture2D(textureU3, vUv));

  float u = dot(vec4(coeffU[0], coeffU[1], coeffU[2], coeffU[3]), tex0) + 
     dot(vec4(coeffU[4], coeffU[5], coeffU[6], coeffU[7]), tex1) + 
     dot(vec4(coeffU[8], coeffU[9], coeffU[10], coeffU[11]), tex2) +
     dot(vec4(coeffU[12], coeffU[13], coeffU[14], coeffU[15]), tex3);

  tex0 = scale(texture2D(textureV0, vUv));
  tex1 = scale(texture2D(textureV1, vUv));
  tex2 = scale(texture2D(textureV2, vUv));
  tex3 = scale(texture2D(textureV3, vUv));
  float v = dot(vec4(coeffV[0], coeffV[1], coeffV[2], coeffV[3]), tex0) + 
     dot(vec4(coeffV[4], coeffV[5], coeffV[6], coeffV[7]), tex1) + 
     dot(vec4(coeffV[8], coeffV[9], coeffV[10], coeffV[11]), tex2) +
     dot(vec4(coeffV[12], coeffV[13], coeffV[14], coeffV[15]), tex3);

  vec4 rgb = colorMatrix * vec4(y, u, v, 0.0);
  gl_FragColor = vec4(rgb.x, rgb.y, rgb.z, 1.0);
}
</script>


<style>
.container {
  width: 640px;
  height: 480px;
}

canvas {
  width: 640px;
  height: 480px;
}

</style>
<body>
<span>
Choose model:
</span>
<select id='select'>
  <option value='houseSFS.yxv'>House</option>
  <option value='elephant_scorpion.yxv'>Elephant</option>
  <option value='Guba.yxv'>Guba</option>
  <option value='quack2.yxv'>Quack</option>
  <option value='pig.yxv'>Pig</option>
  <option value='neil_small.yxv'>Neil Chair</option>
</select>

<span>
Static texture:
</span> <input type='checkbox' id='static'/>

<span>Shaded:</span> <input type='checkbox' id='shaded'/>

<img src='' id='image' />
 <div class='container' id='container'></div>
<script>

var main = new renderer.Main();

// Setup the selection.
var select = document.getElementById('select');
var static = document.getElementById('static');
var shaded = document.getElementById('shaded');

select.onchange = function() {
  main.removeAllObjects();
  main.loadModel('objects/' + select.value, function() {
    console.log('Loaded');
  }, function() {
    console.error('Error loading');
  });
};

static.onchange = function() {
  console.log('Static'); 
  main.setUseStaticTexture(static.checked);
};

shaded.onchange = function() { 
  if (shaded.checked) {
    main.useShadedMaterial();
  } else {
    main.setUseStaticTexture(static.checked);
  } 
};

main.run();

</script>
</body>
</html>
